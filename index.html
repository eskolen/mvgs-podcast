<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Podcaster fra Mysen VGS</title>
    <meta name="description" content="Hør på våre podcaster fra Mysen vgs - episoder om skole, læring og samfunn">
    
    <!-- Podcast RSS Discovery -->
    <link rel="alternate" type="application/rss+xml" title="INDIREKTE - en podcast fra Mysen vgs" href="https://mvgs.duckdns.org/podcast/rss.xml">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #fdf2e9 0%, #fef7f0 50%, #fffcfa 100%);
            min-height: 100vh;
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 40px 20px;
        }
        
        .header {
            text-align: center;
            color: #d2691e;
            margin-bottom: 50px;
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(210, 105, 30, 0.1);
            border-top: 6px solid #d2691e;
        }
        
        .header h1 {
            font-size: 3em;
            margin-bottom: 20px;
            text-shadow: none;
            color: #d2691e;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.8;
            color: #b8621a;
        }
        
        .work-notice {
            background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
        }
        
        .work-notice h3 {
            margin-bottom: 10px;
            font-size: 1.3em;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .podcast-info {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(210, 105, 30, 0.08);
            height: fit-content;
            border-top: 5px solid #d2691e;
        }
        
        .subscribe-section {
            text-align: center;
            margin: 0;
        }
        
        .subscribe-section h2 {
            margin-bottom: 20px;
            color: #d2691e;
            font-size: 1.5em;
        }
        
        .rss-box {
            background: linear-gradient(135deg, #fef7f0 0%, #fdf2e9 100%);
            border: 2px solid #d2691e;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
        }
        
        .episodes {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(210, 105, 30, 0.08);
            border-top: 5px solid #ff8c00;
        }
        
        .rss-url {
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            word-break: break-all;
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #d2691e;
            margin: 15px 0;
            user-select: all;
        }
        
        .copy-button {
            background: linear-gradient(135deg, #d2691e 0%, #ff8c00 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin: 10px 5px;
            box-shadow: 0 4px 12px rgba(210, 105, 30, 0.3);
        }
        
        .copy-button:hover {
            background: linear-gradient(135deg, #ff8c00 0%, #d2691e 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(210, 105, 30, 0.4);
        }
        
        .copy-button.copied {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
        }
        
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin: 25px 0;
        }
        
        .browse-link {
            background: linear-gradient(135deg, #ff8c00 0%, #ff6347 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(255, 140, 0, 0.3);
        }
        
        .browse-link:hover {
            background: linear-gradient(135deg, #ff6347 0%, #ff8c00 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 140, 0, 0.4);
            color: white;
        }
        
        .episodes h2 {
            margin-bottom: 25px;
            font-size: 1.8em;
            color: #d2691e;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .episode {
            border-bottom: 1px solid #ffeedd;
            padding: 25px 0;
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }
        
        .episode:last-child {
            border-bottom: none;
        }
        
        .episode-image {
            flex-shrink: 0;
            width: 120px;
            height: 120px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(210, 105, 30, 0.15);
            border: 2px solid #ff8c00;
        }
        
        .episode-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .episode-content {
            flex: 1;
        }
        
        .episode h3 {
            color: #d2691e;
            margin-bottom: 8px;
            font-size: 1.3em;
        }
        
        .episode-meta {
            color: #ff8c00;
            font-size: 0.9em;
            margin-bottom: 12px;
            font-weight: 500;
        }
        
        .episode-description {
            color: #555;
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .episode-description p {
            margin-bottom: 10px;
        }
        
        .episode-description p:last-child {
            margin-bottom: 0;
        }
        
        .episode-description strong {
            color: #d2691e;
            font-weight: 600;
        }
        
        .episode-description a {
            color: #ff8c00;
            text-decoration: none;
            font-weight: 500;
        }
        
        .episode-description a:hover {
            text-decoration: underline;
            color: #d2691e;
        }
        
        .episode-description .hashtags {
            color: #ff8c00;
            font-style: italic;
            margin-top: 10px;
        }
        
        .episode audio {
            width: 100%;
            margin-top: 10px;
            border-radius: 8px;
        }
        
        .episode audio::-webkit-media-controls-panel {
            background-color: #fef7f0;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #d2691e;
            font-size: 1.1em;
        }
        
        .error {
            text-align: center;
            padding: 40px;
            color: #dc3545;
            background: linear-gradient(135deg, rgba(220, 53, 69, 0.1) 0%, rgba(255, 255, 255, 0.9) 100%);
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #dc3545;
        }
        
        .success-message {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #27ae60;
            display: none;
            box-shadow: 0 2px 10px rgba(39, 174, 96, 0.2);
        }
        
        /* Custom scrollbar styling */
        ::-webkit-scrollbar {
            width: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #d2691e 0%, #ff8c00 100%);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #b8621a 0%, #9b5317 100%);
        }
        
        @media (max-width: 768px) {
            .header h1 { font-size: 2em; }
            .container { padding: 20px 15px; }
            .podcast-info, .episodes { padding: 25px; }
            
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .episode {
                flex-direction: column;
                text-align: center;
            }
            
            .episode-image {
                width: 100px;
                height: 100px;
                margin: 0 auto;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .episodes h2 {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎧 INDIREKTE - en podcast fra Mysen vgs</h1>
            <p>Perspektiver på skole, læring og samfunn</p>
        </div>
        
        <div class="work-notice">
            <h3>🏢 Work-Friendly Access</h3>
            <p>This page is hosted on GitHub Pages for reliable access from corporate/school networks. Copy the RSS URL below to subscribe in your podcast app.</p>
        </div>
        
        <div class="main-content">
            <div class="podcast-info">
                <div class="subscribe-section">
                    <h2>🚀 Abonner på podcasten</h2>
                    <p>Kopier RSS-lenken og lim den inn i din favoritt podcast-app:</p>
                    
                    <div class="rss-box">
                        <strong>RSS Feed URL:</strong>
                        <div class="rss-url" id="rss-url">https://mvgs.duckdns.org/podcast/rss.xml</div>
                        <div class="action-buttons">
                            <button class="copy-button" onclick="copyRSSUrl()">
                                📋 Kopier RSS-lenke
                            </button>
                        </div>
                        <div class="success-message" id="copy-success">
                            ✅ RSS-lenken er kopiert til utklippstavlen!
                        </div>
                    </div>
                </div>                
            </div>
            
            <div class="episodes">
                <h2>📻 Siste episoder</h2>
                <div id="episode-list">
                    <div class="loading">
                        <p>📄 Laster inn episoder...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Copy RSS URL to clipboard
        async function copyRSSUrl() {
            const rssUrl = document.getElementById('rss-url').textContent;
            const button = event.target;
            const successMessage = document.getElementById('copy-success');
            
            try {
                await navigator.clipboard.writeText(rssUrl);
                
                // Update button
                button.classList.add('copied');
                button.innerHTML = '✅ Kopiert!';
                
                // Show success message
                successMessage.style.display = 'block';
                
                // Reset after 3 seconds
                setTimeout(() => {
                    button.classList.remove('copied');
                    button.innerHTML = '📋 Kopier RSS-lenke';
                    successMessage.style.display = 'none';
                }, 3000);
                
            } catch (err) {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = rssUrl;
                document.body.appendChild(textArea);
                textArea.select();
                
                try {
                    document.execCommand('copy');
                    button.innerHTML = '✅ Kopiert!';
                    successMessage.style.display = 'block';
                    
                    setTimeout(() => {
                        button.innerHTML = '📋 Kopier RSS-lenke';
                        successMessage.style.display = 'none';
                    }, 3000);
                } catch (fallbackErr) {
                    button.innerHTML = '❌ Kunne ikke kopiere';
                    setTimeout(() => {
                        button.innerHTML = '📋 Kopier RSS-lenke';
                    }, 3000);
                }
                
                document.body.removeChild(textArea);
            }
        }

        // Function to format description text with basic markdown-like formatting
        function formatDescription(text) {
            if (!text) return '';
            
            // First split by double newlines (paragraph breaks)
            const paragraphs = text.split(/\n\s*\n/);
            let formattedParagraphs = [];
            
            for (let paragraph of paragraphs) {
                paragraph = paragraph.trim();
                if (paragraph === '') continue;
                
                // Within each paragraph, treat single newlines as line breaks
                const lines = paragraph.split('\n');
                let processedLines = [];
                
                for (let line of lines) {
                    line = line.trim();
                    if (line === '') continue;
                    
                    // Process formatting
                    let processedLine = line;
                    
                    // Bold text (**text**)
                    processedLine = processedLine.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                    
                    // Links (simple URL detection)
                    processedLine = processedLine.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank">$1</a>');
                    
                    // Hashtags
                    if (processedLine.includes('#')) {
                        processedLine = processedLine.replace(/(#\w+)/g, '<span class="hashtag">$1</span>');
                    }
                    
                    processedLines.push(processedLine);
                }
                
                // Join lines with <br> for single line breaks within paragraph
                const paragraphContent = processedLines.join('<br>');
                formattedParagraphs.push('<p>' + paragraphContent + '</p>');
            }
            
            // Handle hashtags at the end
            let result = formattedParagraphs.join('');
            if (result.includes('hashtag')) {
                result = result.replace(/(<p>.*<span class="hashtag">.*<\/p>)/, '<div class="hashtags">$1</div>');
            }
            
            return result;
        }

        async function loadEpisodes() {
            const episodeList = document.getElementById('episode-list');
            
            try {
                // Try to fetch the RSS feed - this may fail at work, which is fine
                const response = await fetch('https://mvgs.duckdns.org/podcast/rss.xml');
                
                if (!response.ok) {
                    throw new Error('RSS feed not accessible');
                }
                
                const rssText = await response.text();
                const parser = new DOMParser();
                const rssDoc = parser.parseFromString(rssText, 'text/xml');
                
                // Check for parsing errors
                const parserError = rssDoc.querySelector('parsererror');
                if (parserError) {
                    throw new Error('Invalid RSS format');
                }
                
                // Get all episode items
                const items = rssDoc.querySelectorAll('item');
                
                if (items.length === 0) {
                    throw new Error('No episodes found');
                }
                
                // Clear loading message
                episodeList.innerHTML = '';
                
                // Process each episode
                items.forEach((item, index) => {
                    const title = item.querySelector('title')?.textContent || `Episode ${index + 1}`;
                    const description = item.querySelector('description')?.textContent || '';
                    const pubDate = item.querySelector('pubDate')?.textContent || '';
                    const enclosure = item.querySelector('enclosure');
                    const duration = item.querySelector('itunes\\:duration, duration')?.textContent || '';
                    
                    let audioUrl = '';
                    let fileSize = '';
                    
                    if (enclosure) {
                        audioUrl = enclosure.getAttribute('url') || '';
                        const length = enclosure.getAttribute('length');
                        if (length) {
                            fileSize = formatFileSize(parseInt(length));
                        }
                    }
                    
                    // Format publication date
                    let formattedDate = '';
                    if (pubDate) {
                        try {
                            const date = new Date(pubDate);
                            formattedDate = date.toLocaleDateString('nb-NO', {
                                year: 'numeric',
                                month: 'long',
                                day: 'numeric'
                            });
                        } catch (e) {
                            formattedDate = pubDate;
                        }
                    }
                    
                    // Try to find episode image
                    const episodeImageUrl = findEpisodeImage(audioUrl);
                    
                    // Format the description with basic markup
                    const formattedDescription = formatDescription(description);
                    
                    // Create episode element
                    const episodeDiv = document.createElement('div');
                    episodeDiv.className = 'episode';
                    episodeDiv.innerHTML = `
                        ${episodeImageUrl ? `
                            <div class="episode-image">
                                <img src="${episodeImageUrl}" alt="${escapeHtml(title)}" loading="lazy" onerror="this.parentElement.style.display='none'">
                            </div>
                        ` : ''}
                        <div class="episode-content">
                            <h3>${escapeHtml(title)}</h3>
                            <div class="episode-meta">
                                ${formattedDate ? `📅 ${formattedDate}` : ''}
                                ${duration ? ` • ⏱️ ${duration}` : ''}
                                ${fileSize ? ` • 💾 ${fileSize}` : ''}
                            </div>
                            ${formattedDescription ? `<div class="episode-description">${formattedDescription}</div>` : ''}
                            ${audioUrl ? `<audio controls preload="metadata">
                                <source src="${audioUrl}" type="audio/mpeg">
                                Din nettleser støtter ikke audio-elementet.
                            </audio>` : ''}
                        </div>
                    `;
                    
                    episodeList.appendChild(episodeDiv);
                });
                
            } catch (error) {
                console.log('Could not load episodes from server (expected at work):', error);
                episodeList.innerHTML = `
                    <div class="episode">
                        <div class="episode-content">
                            <h3>🎙️ Episodes Available via RSS</h3>
                            <div class="episode-meta">Access episodes through your podcast app</div>
                            <div class="episode-description">
                                <p>Episodes cannot be loaded directly due to network restrictions, but they are available via the RSS feed.</p>
                                <p><strong>To access episodes:</strong></p>
                                <p>1. Copy the RSS URL above<br>
                                2. Open your favorite podcast app<br>
                                3. Add the RSS feed<br>
                                4. Download episodes for offline listening</p>
                                <p><strong>Recent topics include:</strong> Elevmotivasjon, Vurdering ved Mysen vgs, Pedagogisk kompendium, Norskfaget, Skoleutvikling, og AI i utdanning.</p>
                            </div>
                        </div>
                    </div>
                `;
            }
        }
        
        // Function to find episode image based on audio filename
        function findEpisodeImage(audioUrl) {
            if (!audioUrl) return null;
            
            // Extract filename without extension
            const filename = audioUrl.split('/').pop().replace(/\.[^/.]+$/, "");
            
            // Try to find matching image in images folder
            const imageUrl = `https://mvgs.duckdns.org/podcast/images/${filename}.jpg`;
            return imageUrl;
        }
        
        // Helper function to format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // Helper function to escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Load episodes when page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadEpisodes();
        });
    </script>
</body>
</html>
